{{校对翻译}}
{{NoteTA|G1=IT|G2=Windows}}
{{Infobox software
| developer        = [[微软|微软]]
| other_names      = <code>taskschd.msc</code>
| replaces         = 系统代理
| service_name     = Task Scheduler (<code>Schedule</code>)
| included with    = [[Internet_Explorer_4.0|Internet Explorer 4.0]]及之后<br/>[[Windows_98|Windows 98]]及之后
* [[Windows_2000|Windows 2000]] and later<br/>(Windows NT及之后)
| genre            = [[Windows服务|Windows服务]]
}}
'''任务计划程序'''（{{lang-en|'''Task Scheduler'''}}），也称'''计划任务'''。这是[[Microsoft_Windows|Microsoft Windows]]中的一个组件，可以预先计划在特定时间或指定时间后启动程序或脚本。它在[[Windows_95|Windows 95]]的[[Microsoft_Plus!|Microsoft Plus!]]中以“系统代理”（System Agent）首次引入，随后在[[Windows_98|Windows 98]]中被更名为任务计划程序。任务计划程序启动前，[[Windows事件记录|Windows事件记录]]服务必须已在运行。

此服务不应与[[调度_(计算机)|计算机调度]]混淆，因其为分配[[中央处理器|CPU]]资源到内存中的进程。

== 版本 ==

=== 任务计划1.0 ===
任务计划程序1.0搭载于[[Windows_2000|Windows 2000]]、[[Windows_XP|Windows XP]]和[[Windows_Server_2003|Windows Server 2003]]。<ref name="about">{{cite web |url=http://msdn2.microsoft.com/en-us/library/aa446802.aspx |title="About the Task Scheduler" |access-date=2016-06-22 |archive-date=2012-04-20 |archive-url=https://www.webcitation.org/673YELvLN?url=http://msdn.microsoft.com/en-us/library/aa446802.aspx }}</ref>它运行为一个[[Windows服务|Windows服务]]，任务定义和计划存储于[[二进制文件|二进制的]]<code>.job</code>文件，操作各任务就是直接操作各<code>.job</code>文件，每个任务对应一个操作。在[[Windows_95|Windows 95]]、[[Windows_98|Windows 98]]和[[Windows_Me|Windows Me]]中，任务计划程序使用一个普通的<code>mstask.exe</code>程序运行。在Windows 95和Windows 98中，它还在通知区域显示一个状态图标；在Windows Me中则是运行为一个隐藏服务，但可以显示一个托盘图标。<ref>{{Cite web |url=http://support.microsoft.com/kb/272962 |title=How to Enable the Scheduled Tasks Icon in Windows Me |accessdate=2016-06-22 |archive-date=2008-01-30 |archive-url=https://web.archive.org/web/20080130185556/http://support.microsoft.com/kb/272962 |dead-url=no }}</ref>在Windows 2000、Windows XP和Windows Server 2003中，它被实现为一个[[Windows服务|Windows服务]]，计算机程序和[[脚本语言|脚本]]可以通过六个[[组件对象模型|COM]][[介面_(資訊科技)|接口]]访问此服务。<ref>{{Cite web|url=https://msdn.microsoft.com/en-us/library/windows/desktop/aa383581%28v=vs.85%29.aspx|title=Task Scheduler 1.0 Interfaces|accessdate=30 May 2014|date=|last=|first=|publisher=[[Microsoft|Microsoft]]|website=[[MSDN|MSDN]]|archive-date=2016-08-28|archive-url=https://web.archive.org/web/20160828203358/https://msdn.microsoft.com/en-us/library/windows/desktop/aa383581(v=vs.85).aspx}}</ref>微软还提供了一个计划助手DLL、一个例子[[VBScript|VBScript]]和一个自动任务计划程序的配置文件。<ref>{{Cite web |url=http://www.microsoft.com/downloads/details.aspx?displaylang=en&FamilyID=601d75e2-f907-4e51-ad88-adb818df1d27 |title=Task Scheduler Using VBScript |accessdate=2016-06-22 |archive-date=2006-05-04 |archive-url=https://web.archive.org/web/20060504033359/http://www.microsoft.com/downloads/details.aspx?FamilyID=601d75e2-f907-4e51-ad88-adb818df1d27&displaylang=en |dead-url=no }}</ref>

任务计划程序除了[[控制面板|控制面板]]中的图形用户界面，Windows还提供两个命令行工具来管理计划任务：<code>at.exe</code>（已弃用）和<code>schtasks.exe</code>。<ref>{{Cite web|url=http://technet.microsoft.com/en-us/library/bb490996.aspx|title=Schtasks|accessdate=18 May 2014|work=Windows XP command-line reference|publisher=[[Microsoft|Microsoft]]|archive-date=2018-02-03|archive-url=https://web.archive.org/web/20180203082409/https://technet.microsoft.com/en-us/library/bb490996.aspx}}</ref><ref>{{Cite web|url=http://technet.microsoft.com/en-us/library/bb490866.aspx|title=At|accessdate=18 May 2014|work=Windows XP command-line reference|publisher=[[Microsoft|Microsoft]]|archive-date=2018-02-03|archive-url=https://web.archive.org/web/20180203082331/https://technet.microsoft.com/en-us/library/bb490866.aspx}}</ref>但是，<code>at.exe</code>不能访问用控制面板或<code>schtasks.exe</code>创建或修改的任务。<ref>{{Cite web|url=http://support.microsoft.com/kb/313565|title=How To Use the AT Command to Schedule Tasks|accessdate=|date=30 October 2006|last=|first=|publisher=[[Microsoft|Microsoft]]|website=Support|edition=4.5|archive-date=2015-03-07|archive-url=https://web.archive.org/web/20150307000724/http://support.microsoft.com/kb/313565|dead-url=no}}</ref>另外，使用<code>at.exe</code>创建的任务默认非交互；交互任务需要被显式请求。<ref>{{Cite web|url=http://support.microsoft.com/kb/121562/EN-US|title=Applications Started with AT Are Not Interactive|accessdate=|date=20 February 2007|last=|first=|publisher=[[Microsoft|Microsoft]]|website=Support|edition=3.2|archive-date=2004-10-29|archive-url=https://web.archive.org/web/20041029024318/http://support.microsoft.com/kb/121562/EN-US/|dead-url=no}}</ref>

=== 任务计划2.0 ===
任务计划程序2.0在[[Windows_Vista|Windows Vista]]、[[Windows_Server_2008|Windows Server 2008]]及之后版本中存在。<ref name="about"/>重新设计的“任务计划程序”用户界面基于[[微软管理控制台|微软管理控制台]]。除了在指定的时间或时间间隔后运行任务，任务计划程序2.0还支持日历和基于事件的触发器，比如在特定日志被记录到事件日志时启动一个任务，或者在发生一系列事件时启动任务。另外，同一个事件触发的多个任务可以配置为同时或者按预先配置的顺序以链式执行一系列动作，而无须创建多个计划任务。任务也可配置为基于系统状态运行，诸如闲置指定时间、启动时、注销时，或者只是特定周期或指定时间。对[[事件檢視器|Windows事件日志]]还可以使用[[XPath|XPath]]表达式过滤。任务也可在指定事件发生后延迟指定时间再执行，或者不断重复直至其他某些事件发生。任务还可配置运行失败时执行的操作。操作可以响应触发器，既基于事件又基于时间，不仅包含启动应用程序，还执行一系列自定义操作。任务计划程序已包含大量为众多应用程序准备的内置操作，包括发送电子邮件、显示消息框、触发一个[[组件对象模型|COM]]句柄等。使用任务计划程序API还可指定自定义操作。任务计划程序会在历史日志保留所有任务的所有执行详细信息。<ref name="taskscheduler">{{Cite web|url=http://www.microsoft.com/technet/windowsvista/mgmntops/taskschd.mspx|title=Windows Vista Task Scheduler|accessdate=2006-04-24|date=March 3, 2006|publisher=Microsoft TechNet|archive-url=https://web.archive.org/web/20060424221817/http://www.microsoft.com/technet/windowsvista/mgmntops/taskschd.mspx|archive-date=2006-04-24|dead-url=yes}}</ref>Windows Vista使用任务计划程序2.0运行各种系统级任务；<ref>{{Cite web |url=http://support.microsoft.com/kb/939039 |title=Description of the scheduled tasks in Windows Vista |accessdate=2016-06-22 |archive-date=2007-10-22 |archive-url=https://web.archive.org/web/20071022033307/http://support.microsoft.com/kb/939039 |dead-url=no }}</ref>因此，任务计划程序服务不再允许被禁用（除非直接修改注册表）。

任务计划程序2.0提供了一个[[应用程序接口|API]]以允许计算机程序和脚本创建任务。<ref name="kerr">{{Cite web|url=http://msdn.microsoft.com/msdnmag/issues/07/10/WindowsCPP/|title=Task Scheduler 2.0|accessdate=2007-10-06|author=Kenny Kerr|publisher=[[MSDN|MSDN]]|archive-url=https://web.archive.org/web/20071226223747/http://msdn.microsoft.com/msdnmag/issues/07/10/WindowsCPP/|archive-date=2007-12-26|dead-url=yes}}</ref>它采用42个[[组件对象模型|COM]][[介面_(資訊科技)|接口]]组成。<ref>{{Cite web|url=https://msdn.microsoft.com/en-us/library/aa383600%28v=vs.85%29.aspx|title=Task Scheduler 2.0 Interfaces|accessdate=30 May 2014|date=|last=|first=|publisher=[[Microsoft|Microsoft]]|website=[[MSDN|MSDN]]|archive-date=2016-03-04|archive-url=https://web.archive.org/web/20160304064628/https://msdn.microsoft.com/en-us/library/aa383600(v=vs.85).aspx}}</ref>任务计划程序2.0的任务文件基于[[XML|XML]]并且人类可读，遵循“任务计划程序方案架构”。<ref name="kerr">{{Cite web|url=http://msdn.microsoft.com/msdnmag/issues/07/10/WindowsCPP/|title=Task Scheduler 2.0|accessdate=2007-10-06|author=Kenny Kerr|publisher=[[MSDN|MSDN]]|archive-url=https://web.archive.org/web/20071226223747/http://msdn.microsoft.com/msdnmag/issues/07/10/WindowsCPP/|archive-date=2007-12-26|dead-url=yes}}</ref>虽然可以做到，但微软不建议手动创建任务文件，而应该使用任务计划程序API。

==== 其他功能 ====
* 新的安全功能，包括使用“凭据管理器”为[[工作组|工作组]]计算机的任务提供密码，使用[[Active_Directory|Active Directory]]为{{tsl|en|Windows_domain|加入域}}的计算机的任务提供凭据，以防止这些信息被轻易检索。另外，计划任务会在其自身的会话执行，而不是使用当前用户的系统服务会话。
* 可以唤醒远程计算机，或使用[[BIOS|BIOS]]计时器将机器从睡眠或休眠中唤醒，以执行计划任务或运行刚错过的计划任务。
* 可以将任务直接附加到[[事件檢視器|事件查看器]]中的事件。

== 任务 ==
任务计划程序按各项受管理的任务运作。任务会在特定条件下以执行操作响应。<span class="cx-segment" data-segmentid="228"></span>定义一个任务可以关联一系列操作，其中可以包括启动应用程序或采取其他自定义操作，to a set of triggers, which can either基于时间或基于事件。此外，一个任务也可以包含定义如何执行操作的元数据，例如任务将在哪个安全上下文运行。任务被序列化为<code>.job</code>文件并存储在名为“任务文件夹”的[[特殊文件夹|特殊文件夹]]中。在编程角度，任务文件夹可以使用<code>ITaskFolder</code>接口或<code>TaskFolder</code>脚本对象访问，单个任务可以使用<code>IRegisteredTask</code>接口或<code>RegisteredTask</code>对象访问。<ref>{{Cite web|url=http://msdn2.microsoft.com/en-us/library/aa382589.aspx|title=Tasks (Windows)|accessdate=2007-10-06|publisher=[[MSDN|MSDN]]|archive-date=2008-02-13|archive-url=https://web.archive.org/web/20080213090642/http://msdn2.microsoft.com/en-us/library/aa382589.aspx}}</ref>

== 软件缺陷 ==
在Windows 2000和Windows XP中，当计算机准备使用<code>[[sysprep|sysprep]]</code>进行磁盘映像时，分配给以系统权限运行的任务不起作用。Sysprep会更改[[安全标识符|安全标识符]]（SID）以避免重复，但不会更新计划任务为使用新的SID。因此，所有SYSTEM的计划任务在映像的计算机上都会运行失败。没有适用于此问题的解决方案，但重新计划该任务可以暂时缓解问题。<ref>{{Cite web|url=http://support.microsoft.com/kb/313111|title=Scheduled tasks may not start if you used a System Preparation image to install Windows XP or Windows 2000|accessdate=19 May 2012|date=1 July 2004|work=Microsoft Support|publisher=Microsoft|archive-date=2013-04-13|archive-url=https://web.archive.org/web/20130413034432/http://support.microsoft.com/kb/313111}}</ref>

在Windows Vista和Windows Server 2008上，如果未安装Service Pack 2，任务计划程序中的“下次运行时间”可能显示错误。<ref>{{Cite web|url=http://support.microsoft.com/kb/950035|title=The value in the Next Run Time field in Task Scheduler is incorrect in Windows Vista and in Windows Server 2008|accessdate=19 May 2012|date=15 October 2008|work=Microsoft Support|publisher=Microsoft|archive-date=2014-03-08|archive-url=https://web.archive.org/web/20140308045656/http://support.microsoft.com/kb/950035}}</ref>

當用戶在[[Windows_Vista|Windows Vista]]、7、2008以及2008 R2作業系統上的「微软管理控制台」运行“任务计划程序2.0”版本时会提示用户當前正在运行“任务计划程序1.0”的通知。雖然只是一个不足为虑的小瑕疵，很可能是软件开发人员在重写该组件时忘记修复此Bug。但在后续的Windows 8和Windows Severe 2012作業系統中已得到糾正。

== 参见 ==
* {{tsl|en|Job_scheduling|计划工作任务}}
* [[cron|cron]]
* {{tsl|en|VisualCron|VisualCron}}
* [[任务管理器_(Windows元件)|Windows任务管理器]]

== 参考资料 ==
{{Reflist}}

== 外部链接 ==
* [http://msdn2.microsoft.com/en-us/library/aa383614.aspx Task Scheduler] {{Wayback|url=http://msdn2.microsoft.com/en-us/library/aa383614.aspx |date=20080420101334 }} on [[微软开发者网络|MSDN]]
* [http://support.microsoft.com/kb/303204 The Log File in the Task Scheduler May Be Incorrectly Formatted and Difficult to Read] {{Wayback|url=http://support.microsoft.com/kb/303204 |date=20141108002233 }}
* [http://support.microsoft.com/kb/191427/en-us Unable to Delete Text in the Task Scheduler Log File] {{Wayback|url=http://support.microsoft.com/kb/191427/en-us |date=20130413043516 }}
* [http://support.microsoft.com/kb/215937/en-us Task Scheduler Service Does Not Start] {{Wayback|url=http://support.microsoft.com/kb/215937/en-us |date=20140430225620 }}
* [http://support.microsoft.com/kb/178691/en-us Scheduled Program Does Not Start in Task Scheduler] {{Wayback|url=http://support.microsoft.com/kb/178691/en-us |date=20140608234213 }}
* [http://support.microsoft.com/kb/195933/en-us Cannot Disable Task Scheduler] {{Wayback|url=http://support.microsoft.com/kb/195933/en-us |date=20130413041306 }}
* [http://adaxes.com/active-directory_scheduled-tasks.htm Scheduled Tasks for Active Directory Management] {{Wayback|url=http://adaxes.com/active-directory_scheduled-tasks.htm |date=20111217045440 }}
* [http://taskscheduler.codeplex.com Task Scheduler Managed Wrapper] {{Wayback|url=http://taskscheduler.codeplex.com/ |date=20180102110931 }}

{{Windows Components}}
{{Windows commands}}
{{Microsoft APIs}}

[[Category:Windows管理|Category:Windows管理]]
[[Category:Windows服务|Category:Windows服务]]