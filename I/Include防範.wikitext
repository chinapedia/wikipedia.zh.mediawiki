{{NoteTA|T=zh:#include防範;zh-hant:#include防範;zh-hans:#include防范;|
G1=IT}}
在[[C語言|C]]和[[C++|C++]]程式語言中，'''#include防範'''，有時被稱作'''巨集防範'''，用於處理<code>#include</code> [[編譯器指導指令|指令]]時，可避免'''重複引入'''的問題。在[[標頭檔|標頭檔]]加入#include防範是一種讓檔案[[等冪|等冪]]的方法。

== 重複引入 ==
以下的C語言程式展示了缺少#include防範時會出現的問題：

;檔案「grandfather.h」
<syntaxhighlight lang="c">
struct foo {
    int member;
};
</syntaxhighlight>
;檔案「father.h」
<syntaxhighlight lang="c">
#include "grandfather.h"
</syntaxhighlight>
;檔案「child.c」
<syntaxhighlight lang="c">
#include "grandfather.h"
#include "father.h"
</syntaxhighlight>
此處'''child.c'''間接引入了兩份'''grandfather.h'''[[標頭檔|標頭檔]]中的內容。明顯可以看出，<code>foo</code>結構被定義兩次，因此會造成編譯錯誤。

== 使用#include防範 ==
;檔案「grandfather.h」
<syntaxhighlight lang="c">
#ifndef GRANDPARENT_H
#define GRANDPARENT_H
 
struct foo {
    int member;
};
 
#endif
</syntaxhighlight>
;檔案「father.h」
<syntaxhighlight lang="c">
#include "grandfather.h"
</syntaxhighlight>
;檔案「child.c」
<syntaxhighlight lang="c">
#include "grandfather.h"
#include "father.h"
</syntaxhighlight>
此處'''grandfather.h'''第一次被引入時會定義巨集'''GRANDPARENT_H'''。當'''father.h'''再次引入'''grandfather.h'''時，<code>#ifndef</code>測試失敗，[[編譯器|編譯器]]會直接跳到<code>#endif</code>的部分，也避免了第二次定義<code>foo</code>結構。程式也就能夠正常編譯。

== 困難 ==
為了讓'''#include防範'''正確運作，每個防範都必須檢驗並且有條件地設定不同的[[前置處理|前置處理]]巨集。因此，使用了'''#include防範'''的方案必須制訂一致性的命名方法，並確定這個方法不會和其他的[[標頭檔|標頭檔]]或任何可見的全域變數衝突。

為了解決這個問題，許多C和C++程式開發工具提供非標準的指令<code>[[pragma_once|#pragma once]]</code>。在[[標頭檔|標頭檔]]中加入這個指令，能夠保證這個檔案只會被引入一次。不過這個方法會被潛在性顯著的困難阻撓，無論<code>#include</code>指令是否在不同的地方，但實際上起源於相同的開頭（舉例，請參考[[符號連結|符號連結]]）。同樣的，因為<code>#pragma once</code>不是一個標準的指令，它的語意在不同的程式開發工具中也許會有微妙的不同。

== 参考文献 ==
{{Reflist}}

== 外部連結 ==
* [https://web.archive.org/web/20100819052043/http://www.bobarcher.org/software/include/index.html 引入防範的最佳化]
* [http://c2.com/cgi/wiki?RedundantIncludeGuards 多餘的引入防範]{{Wayback|url=http://c2.com/cgi/wiki?RedundantIncludeGuards |date=20070212120543 }}
* [https://web.archive.org/web/20070930015629/http://www.codeproject.com/tools/includeguard.asp 引入防範生成器]

[[Category:C語言|Category:C語言]]
[[Category:C頭文件|#include]]