{{lowercase|title=ar (Unix)}}
{{NoteTA|G1=IT}}
{{Infobox software
| name = ar
| logo = 
| screenshot = 
| screenshot size = 
| caption = 
| author = [[肯·汤普逊|肯·汤普逊]] [[丹尼斯·里奇|丹尼斯·里奇]]
（[[贝尔实验室|贝尔实验室]]）
| developer = 各类开源和商业软件开发者。
| released = {{Start date and age|1971|11|3}}
| latest release version = 
| latest release date = 
| operating system = [[Unix|Unix]], [[类Unix系统|类Unix系统]], [[UNIX_System_V|V]], [[貝爾實驗室九號計畫|Plan 9]], [[Inferno|Inferno]]
| platform = [[跨平臺|跨平臺]]
| genre = [[命令_(计算机)|命令]]
| license = 
| website = 
}}
{{Infobox file format
| name                   = archiver
| icon                   =
| logo                   =
| screenshot             =
| caption                =
| extension              = {{code|.a}}, {{code|.lib}}, {{code|.ar}}<ref name="x-archive" />
| mime                   = application/x-archive<ref name="x-archive">{{cite web|url=https://reposcope.com/mimetype/application/x-archive|title=application/x-archive|accessdate=2019-03-11|archive-date=2019-12-08|archive-url=https://web.archive.org/web/20191208113015/https://reposcope.com/mimetype/application/x-archive}}</ref>
| type code              =
| uniform type           =
| magic                  = {{code|!<arch>}}
| owner                  =
| released               = <!-- {{Start date|YYYY|mm|dd|df=yes}} -->
| latest release version =
| latest release date    = <!-- {{Start date and age|YYYY|mm|dd|df=yes}} -->
| genre                  = [[归档格式|归档格式]]
| container for          = 一般是 [[目标文件|目标文件]] ({{code|.o}}, {{code|.obj}})
| contained by           =
| extended from          =
| extended to            =
| standard               = 未标准化，有多种形式
| free                   = 是<ref name="ar(1) - Linux man page"/>
| url                    =
}}

'''ar'''（'''archiver'''）是[[UNIX|Unix系统]]上的[[归档工具|归档工具]]，用于将多个文件归档为一个文件。<code>ar</code>目前一般仅被[[链接器|链接器]]用创建更新[[静态库|静态库]]和生成[[.deb|.deb包]]。它的归档功能现在基本被 <code>[[tar|tar]]</code>所取代。<ref name="Static Libraries">{{cite web|title=Static Libraries|url=http://tldp.org/HOWTO/Program-Library-HOWTO/static-libraries.html|publisher=TLDP|accessdate=3 October 2013|archive-date=2013-07-03|archive-url=https://web.archive.org/web/20130703011904/http://tldp.org/HOWTO/Program-Library-HOWTO/static-libraries.html}}</ref> [[GNU_Binutils|GNU Binutils]]包含<code>ar</code> .<ref name="ar(1) - Linux man page">{{cite web|title=ar(1) - Linux man page|url=http://linux.die.net/man/1/ar|accessdate=3 October 2013|archive-date=2019-02-12|archive-url=https://web.archive.org/web/20190212221729/https://linux.die.net/man/1/ar}}</ref>

[[Linux标准规范|Linux标准规范]]（LSB）中，<code>ar</code> 已被弃用，并可能在将来的版本中移除，理由是LSB不应包含[[软件开发工具|软件开发工具]]和指定.o和.a文件格式。<ref>Linux Standard Base Core Specification, version 4.1, Chapter 15. Commands and Utilities > [http://refspecs.linuxfoundation.org/LSB_4.1.0/LSB-Core-generic/LSB-Core-generic/ar.html ar] {{Wayback|url=http://refspecs.linuxfoundation.org/LSB_4.1.0/LSB-Core-generic/LSB-Core-generic/ar.html |date=20131106081331 }}</ref>

==文件格式==
[[File:Deb_File_Structure.svg|thumb]]
ar格式从未标准化过，历史上有过多种形式<ref name="Levine99">{{cite book|author-last=Levine|id={{ISBN|978-1-55860-496-4}}|archive-url=https://archive.today/20121205032107/http://www.iecc.com/linker/|url-status=live|access-date=2020-01-12|url=https://www.iecc.com/linker/|pages=|chapter-url=<!-- http://www.iecc.com/linker/linker6.html |chapter-archive-url=-->https://archive.today/5LnUa|chapter=Chapter 6: Libraries|oclc=42413382|isbn=1-55860-496-0|author-first=John R.|location=San Francisco, USA|series=The Morgan Kaufmann Series in Software Engineering and Programming|publisher=[[Morgan_Kaufmann|Morgan Kaufmann]]|edition=1|orig-year=October 1999|date=2000|title=Linkers and Loaders|author-link=John R. Levine|archive-date=2012-12-05}} Code: [https://archive.today/20200114225034/https://linker.iecc.com/code.html][ftp://ftp.iecc.com/pub/linker/] Errata: [https://linker.iecc.com/] {{Wayback|url=https://linker.iecc.com/ |date=20210502145045 }}</ref> 如 [[Version_6_Unix|V6]], [[Version_7_Unix|V7]], [[AIX|AIX]]和Coherent等，与通用格式都有很大的差别。<ref name="ar5">{{Cite web |url=http://www.freebsd.org/cgi/man.cgi?query=ar&sektion=5&manpath=4.3BSD+NET%2F2 |title=Manual page for NET/2 ar file format |access-date=2020-09-22 |archive-date=2017-08-22 |archive-url=https://web.archive.org/web/20170822093202/https://www.freebsd.org/cgi/man.cgi?query=ar&sektion=5&manpath=4.3BSD+NET%2F2 }}</ref>现在的通用格式主要基于两种变体：[[BSD|BSD]] 和 [[System_V|System V]]（最初称为 [[COFF|COFF]]，也被 [[GNU|GNU]]， [[ELF|ELF]]和[[Windows_API|Windows]]使用。）[[Debian|Debian]]的 ".[[deb|deb]]" 使用通用格式。

.ar文件起始是一个全局文件头，接着是各个文件的文件头和数据部分。数据部分为2字节[[对齐|对齐]]，如果数据长度为[[奇数|奇数]]，则填充一个[[换行符|换行符]]（\n，0x0A）。
===特征签名===
为 <code>"!<arch>"</code> 和换行符（0x0A）.

===文件头===
归档的每个文件包含文件头存储文件信息。下表为通用格式。数值为[[ASCII编码|ASCII编码]]，并用[[空格|空格]](0x20)向右填充。
{| class="wikitable"
|- bgcolor="#CCCCCC"
!偏移
!长度
!名称
!各式
|-
|0
|16
|文件标识符
|ASCII
|-
|16
|12
|[[時間戳|文件修改时间]]
|[[十进制|十进制]]
|-
|28
|6
|所有者ID
|十进制
|-
|34
|6
|组ID
|十进制
|-
|40
|8
|文件模式
|[[八进制|八进制]]
|-
|48
|10
|文件大小字节数
|十进制
|-
|58
|2
|结束字符
|0x60 0x0A
|}
标头全部为可打印的ASCII字符和换行符，所以只包含文本文件的ar归档文件仍然是文本文件。

每个文件从偶数字节开始，如果长度为奇数，则需要填充一个换行符，文件头中的文件大小存储是实际大小。<ref>{{cite web|title=ar.h|url=http://www.unix.com/man-page/opensolaris/3head/ar.h/|work=www.unix.com|publisher=The UNIX and Linux Forums}}</ref>

由于文件名长度和格式的限制，GNU和BSD变体都设计了不同的存储长文件名的方法。尽管通用格式不会受到[[2038年问题|2038年问题]]的困扰，但很多系统上的ar程序存在这种问题，可能需要修改以正确处理超过2147483647的时间戳。有关这些扩展的说明，请参见libbfd。<ref>{{cite web |title=bminor/binutils-gdb: archive.c |url=https://github.com/bminor/binutils-gdb/blob/master/bfd/archive.c |website=GitHub |language=en |access-date=2020-09-22 |archive-date=2021-03-05 |archive-url=https://web.archive.org/web/20210305211729/https://github.com/bminor/binutils-gdb/blob/master/bfd/archive.c }}</ref>

根据格式的不同，许多ar实现了用于快速链接的全局符号表（armap，目录或索引）而无需扫描整个存档中的符号。[[POSIX|POSIX]]识别此功能，并且要求ar实现具有 {{code|-s}}选项更新符号表。大多数实现将其放在第一个文件条目中。<ref>{{man|1|ar|SUS}}</ref>

====BSD变体====
BSD ar 在文件名头填充ASCII空格符，文件名如包含空格会有问题。[[4.4BSD|4.4BSD]] ar将"#1/"和文件名长度放置在文件名字段，并将文件名放置在数据段的最前面<ref name="ar5"/>

BSD ar 自身不处理全局符号查找表，而使用单独的工具'''ranlib'''<ref>{{Cite web |url=http://www.freebsd.org/cgi/man.cgi?query=ranlib&manpath=4.3BSD+NET%2F2 |title=Manual page for NET/2 ranlib utility |access-date=2020-09-22 |archive-date=2021-02-26 |archive-url=https://web.archive.org/web/20210226000246/http://www.freebsd.org/cgi/man.cgi?query=ranlib&manpath=4.3BSD+NET%2F2 }}</ref>。ranlib会插入一个与系统架构相关的文件 <code>__.SYMDEF</code>作为第一个文件<ref>{{Cite web |url=http://www.freebsd.org/cgi/man.cgi?query=ranlib&sektion=5&manpath=4.3BSD+NET%2F2 |title=Manual page for NET/2 ranlib file format |access-date=2020-09-22 |archive-date=2021-02-25 |archive-url=https://web.archive.org/web/20210225174935/http://www.freebsd.org/cgi/man.cgi?query=ranlib&sektion=5&manpath=4.3BSD+NET%2F2 }}</ref> 一些后来的版本会在名称后面放置一个空格和"SORTED"字符表示已排序。<ref>{{cite web |title=ranlib.h |url=https://opensource.apple.com/source/Libc/Libc-320/include/ranlib.h.auto.html |website=opensource.apple.com |access-date=2020-09-22 |archive-date=2021-02-27 |archive-url=https://web.archive.org/web/20210227002028/https://opensource.apple.com/source/Libc/Libc-320/include/ranlib.h.auto.html }}</ref> Darwin 64位系统使用{{code|__.SYMDEF_64}}。

由于POSIX规范要求{{code|-s}}选项，新的BSD ar 重新实现了该要求。FreeBSD 弃用了 SYMDEF 表而采用 System V 类型的查找表。<ref>{{man|5|ar|FreeBSD}}</ref>

====System V（或 GNU）变体====
System V ar 用字符'/'（0x2F）标记文件名结束，从而文件名可以使用空格。需要扩展的文件将文件名存储在"//"文件的数据段，在标头文件名字段中写入'/'和十进制的偏移地址。 "//"文件包含的是长文件名列表，以换行符分割。通常 "//" 是第二个条目，符号表为第一个条目。

System V ar 用 "/" 文件名表示对应的数据为符号查找表，包含三部分，并存储为连续的数据。
# 一个32位[[整数|整数]]，[[大端序|大端]]存储：符号表的条目数。
# 一组32位整数，大端存储：每个表示该符号在归档中的位置。
# 一组字符串，0结尾：符号名称

有些 System V ar不使用上述各式，如[[HP-UX|HP-UX]] 11.0，上述信息存储为 [[System_Object_Model|SOM]]文件格式。

为解决4GiB文件限制，某些系统如[[Solaris|Solaris]] 11.2 和 GNU使用不同的查找表。不同之处在于使用64位整数和用"/SYM64/"代替"/"<ref name="ar64bit">{{cite web|title=ar.h(3HEAD)|url=https://docs.oracle.com/cd/E36784_01/html/E36873/ar.h-3head.html|work=docs.oracle.com|4=|publisher=Oracle Corporation|date=11 November 2014|access-date=2018-11-14|archive-date=2021-03-03|archive-url=https://web.archive.org/web/20210303055627/https://docs.oracle.com/cd/E36784_01/html/E36873/ar.h-3head.html}}</ref>

===== Windows 变体 =====
Windows的PE/COFF格式基于 System V/GNU。 第一个条目为 "/" 与System V/GNU符号表相同。第二个条目也是"/"，使用[[小端序|小端]]整数，表示[[ECOFF|ECOFF]]扩展，用于存储经过排序的符号交叉引用表。 <ref name="Levine99"/><ref>{{Citation
 |url=http://www.microsoft.com/msj/0498/hood0498.aspx
 |first=Matt |last=Pietrek |authorlink=Matt Pietrek
 |title=Under The Hood
 |work=Microsoft Systems Journal
 |date=April 1998
 |accessdate=2014-08-23
 |archive-url=https://web.archive.org/web/20070624034732/https://www.microsoft.com/msj/0498/hood0498.aspx
 |archive-date=2007-06-24
}}</ref> 第三个条目为 "//" 长文件名数据。<ref>{{cite web |title=llvm-mirror/llvm: archive.cpp (format detection) |url=https://github.com/llvm-mirror/llvm/blob/ad1310e/lib/Object/Archive.cpp#L593-L610 |website=GitHub |accessdate=10 February 2020 |language=en |archive-date=2021-02-28 |archive-url=https://web.archive.org/web/20210228142403/https://github.com/llvm-mirror/llvm/blob/ad1310e/lib/Object/Archive.cpp#L593-L610 }}</ref>

===Thin archive===
GNU binutils和elfutils中的 {{code|ar}} 有一个 "thin archive" 格式，特征签名为 {{Code|!<thin>}}，仅包含符号表和对该文件的引用。<ref>{{cite web |title=ar |url=https://sourceware.org/binutils/docs/binutils/ar.html |website=GNU Binary Utilities |access-date=2020-09-22 |archive-date=2021-04-18 |archive-url=https://web.archive.org/web/20210418090653/https://sourceware.org/binutils/docs/binutils/ar.html }}</ref>
<!--
== Example usage ==
To create an archive from files {{tt|class1.o}}, {{tt|class2.o}}, {{tt|class3.o}}, the following command would be used:
 ar rcs libclass.a class1.o class2.o class3.o

Unix linkers, usually invoked through the [[C_(programming_language)|C]] compiler <code>cc</code>, can read <code>ar</code> files and extract [[object_code|object files]] from them, so if <code>libclass.a</code> is an archive containing <code>class1.o</code>, <code>class2.o</code> and <code>class3.o</code>, then
 cc main.c libclass.a
or (if libclass.a is placed in standard library path, like {{tt|/usr/local/lib}})
 cc main.c -lclass
or (during linking)
 ld ... main.o -lclass ...
is the same as:
 cc main.c class1.o class2.o class3.o
-->

==参见==
*[[Deb|Deb]]
*[[归档格式|归档格式]]
*[[Unix实用程序列表|Unix实用程序列表]]

==参考==
{{Reflist}}

==外部链接==
{{Wikibooks|Guide to Unix|Commands}}
* {{man|cu|ar|SUS|create and maintain library archives}}
* {{man|1|ar|Plan 9}}
* {{man|1|ar|Inferno}}
* {{man|1|ar|die.net}}
* {{man|1|ar|FreeBSD}}
* {{man|1|ar|v7}}
* {{man|5|ar|FreeBSD}} -- an account of Unix formats
* ''The 32-bit PA-RISC Run-time Architecture Document, HP-UX 11.0 Version 1.0,'' Hewlett-Packard, 1997.<br />See ''Chapter 4: Relocatable Libraries''. Available at [https://web.archive.org/web/20110607140011/http://h21007.www2.hp.com/portal/StaticDownload?attachment_ciid=35ae0c53071b7110VgnVCM100000275d6e10RCRD&ciid=a0f9483d2d2b7110VgnVCM100000275d6e10RCRD] (devresource.hp.com)

{{Unix命令}}
{{歸檔格式}}

[[Category:歸檔格式|Category:歸檔格式]]
[[Category:文件归档器|Category:文件归档器]]
[[Category:GNU计划软件|Category:GNU计划软件]]