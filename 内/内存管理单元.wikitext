{{noteTA
|G1=IT
}}
[[File:MC68451_p1160081.jpg|thumb]]处理器协同使用]]
'''内存管理单元'''（{{lang-en|'''memory management unit'''}}，缩写为'''MMU'''），有时称作'''分页内存管理单元'''（{{lang-en|'''paged memory management unit'''}}，缩写为'''PMMU'''）。它是一种负责处理[[中央处理器|中央处理器]]（CPU）的[[内存|内存]]访问请求的[[计算机硬件|计算机硬件]]。它的功能包括[[虚拟地址|虚拟地址]]到[[物理地址|物理地址]]的转换（即[[虚拟内存|虚拟内存]]管理）<ref>{{Citation|title=Memory management unit|date=1981-12-14|url=https://patents.google.com/patent/US4473878A/en|accessdate=2018-08-15|archive-date=2021-05-12|archive-url=https://web.archive.org/web/20210512025444/https://patents.google.com/patent/US4473878A/en|dead-url=no}}</ref>、[[内存保护|内存保护]]、中央处理器[[高速缓存|高速缓存]]的控制，在较为简单的计算机体系结构中，負責[[总线|总线]]的[[仲裁_(电子器件)|仲裁]]以及[[存储体切换|存储体切换]]（{{lang|en|bank switching}}，尤其是在[[8位|8位]]的系统上）。

== 工作机制 ==
现代的内存管理单元是以页的方式，分割虚拟[[地址空间|地址空间]]（处理器使用的地址范围）的；页的大小是2的n次方，通常为几[[千字节|KB]]（千字节）。地址尾部的n位（页大小的2的次方数）作为页内的偏移量保持不变。其余的地址位（{{lang|en|address}}）为（虚拟）页号。

===页表条目===
内存管理单元通常借助一种叫做[[轉譯旁觀緩衝區|轉譯旁觀緩衝區]]（{{lang|en|Translation Lookaside Buffer}}，缩写为TLB）的相联高速缓存（{{lang|en|associative cache}}）来将虚拟页号转换为物理页号。当后备缓冲器中没有转换记录时，则使用一种较慢的机制，其中包括专用硬件（{{lang|en|hardware-specific}}）的数据结构（{{lang|en|Data structure}}）或软件辅助手段。这个数据结构称为[[分頁表|分页表]]，页表中的数据就叫做分页表项（{{lang|en|page table entry}}，缩写为PTE）。物理页号结合页偏移量便提供出了完整的物理地址。

页表或转换后备缓冲器中数据项包括的信息有：一、“脏位”（页面重写标志位，{{lang|en|dirty bit}}）——表示该页是否被写过。二、“存取位”（{{lang|en|accessed bit}}）——表示该页最后使用于何时，以便于[[最近最少使用算法|最近最少使用]][[页面置换算法|页面置换算法]]（{{lang|en|least recently used page replacement algorithm}}）的实现。三、哪种进程可以读写该页的信息，例如[[用户模式|用户模式]]（{{lang|en|user mode}}）进程还是[[特权模式|特权模式]]（{{lang|en|supervisor mode}}）进程。四、该页是否应被高速缓冲的信息。

有时，TLB或PTE会禁止对虚拟页的访问，这可能是因为没有物理[[随机存取存储器|随机存取存储器]]（{{lang|en|random access memory}}）与虚拟页相关联。如果是这种情况，MMU将向CPU发出[[页错误|页错误]]（{{lang|en|page fault}}）的信号。[[操作系统|操作系统]]({{lang|en|operating system}}）将进行处理，也许会尝试寻找RAM的空白帧，同时建立一个新的PTE将之映射到所请求的虚拟地址。如果没有空闲的RAM，可能必须关闭一个已经存在的页面，使用一些替换算法，将之保存到磁盘中（这被称之为[[分頁|页面调度]]（{{lang|en|paging}}）。在一些MMU中，PTEs或者TLB也存在一些缺点，在这样的情况下操作系统将必须释放空间以供新的映射。

===益处===
有些情况下，软件自身的错误可以引发页错误，这时内存管理单元可以检测到页错误，然后通知操作系统终止出错的程序。通常来说, 操作系统会为每个程序分配虚拟内存地址，而不会让程序直接访问物理内存。这种内存保护特性可以避免某个程序非法访问其他程序的虚拟内存空间。

此外，内存管理单元能够减少程序的内存[[碎片化|碎片化]]现象。也就是说，当程序分配并释放内存块后，可分配的连续内存块的最大尺寸亦远小于尚未分配的内存量。虚拟内存机制可以在内存分页机制的基础上，将多个不连续的物理内存区块映射为一个连续的虚拟内存块。


{{CPU technologies}}
{{内存管理}}

[[Category:虚拟内存|Category:虚拟内存]]