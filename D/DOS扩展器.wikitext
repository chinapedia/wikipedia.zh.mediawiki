{{NoteTA
|G1=IT
}}
[[File:DOS4GWbanner.svg|thumb]]

'''DOS扩展器'''是一个电脑[[软件|软件]]程序，令须[[保护模式|保护模式]]环境的软件能够在[[实模式|实模式]]运行，即使其所处的操作系统衹能在实模式下运作。

DOS扩展器起初在1980年代诞生，目的是要通过[[Intel_80286|Intel 80286]]芯片（稍後扩展到[[Intel_80386|Intel 80386]]）的指令，以应付[[MS-DOS|MS-DOS]]及其它同类型操作系统的内存限制。

== DOS扩展器操作 ==

{| class="wikitable" style="float: right; width: 400px; margin: 1em;"
|+ DOS可见内存
|-
! 实模式<br>640K !! DOS !! DOS
|-
! rowspan="2" style="background: #ffcccc;" | 保护模式 || rowspan="2" style="background: #ffcccc;" | 80286 DOS扩展器<br>16位访问<br>保护模式 || style="background: #ffcccc;" | 80386 DOS扩展器<br>32位访问<br>保护模式
|-
! style="background: #ffcccc;" | 虚拟 8086模式
|}

DOS扩展器，是“扩展的”DOS程序，保护模式程序可藉之透明地使用底层的[[MS-DOS_API|MS-DOS应用接口]]。这很重要：因为许多由DOS所提供的函数接口　须为“16位的段:16位的偏移”形式来指向{{tsl|en|Conventional memory||头640k内存}}中的某一块内存；然而，保护模式以《{{tsl|en|Global Descriptor Table|全局描述符号表}}》描述各段的特征，用段寄存器（现称“选择子”）指向《表》项，此举与实模式不兼容。芯片须切换回实模式（或[[虚拟86模式|虚拟86模式]]）以响应某个非保护模式的请求。

除了要“建起环境、载入程序来执行”之外，DOS扩展器还须提供（其它）转换层，这包括维护它自己在1MB实模式中的所申请的内存[[缓冲器|缓冲器]]，这些缓存用于在底层实模式操作系统与保护模式程序之间传输数据。因为在实模式/虚拟86模式与保护模式之间切换甚为耗时，所以扩展器会复制许多实模式操作功能函数到它自己的保护模式环境内，以此减少切换次数。例如DOS在操作系统与用户级别软件之间的广泛地以[[中断|中断]]来通讯，DOS扩展器则因而拦截许多公用硬件（例如[[实时时钟|实时时钟]]、键盘）与软件（例如DOS自己、鼠标应用接口）的中断。许多扩展器更处理公用中断函数，例如常规视频BIOS中断函数。

DOS扩展器在本质上就是小型操作系统，提供了许多操作系统自己的底层功能。

== 诞生历史 ==
可考证得DOS扩展器是由{{tsl|en|Phar Lap (company)|Phar Lap (公司)|Phar Lap}}所创建，但主推者却是{{tsl|en|Tenberry Software|Tenberry软件公司}}（以前的 Rational 系统）的386{{tsl|en|DOS/4GW|DOS/4GW}}扩展器，它带来了保护模式DOS程序。後来更有 [[Watcom_c|Watcom_c]]在C、C++与Fortran在386芯片级别上的编译器，很快就无处不在地呈现在PC应用程序、游戏（例如[[id_Software|id Software]]的成名软件[[毁灭战士|毁灭战士]]）里了。

开始衹是商务程序之类的内存老饕需要DOS扩展器，後来PC游戏则把DOS扩展器的需求公诸天下。结果DOS扩展器的开发就成功了，两个新软件接口被建立出来，以照顾许多潜在冲突，这些冲突源于多种已存在的内存管理方法，现统一到衹给客户程序提供唯一的接口。

第一个接口是{{tsl|en|Virtual Control Program Interface|虚拟控制程序接口}}（Virtual Control Program Interface，缩写作VCPI），旋为{{tsl|en|DOS Protected Mode Interface|DOS保护模式接口}}（DOS Protected Mode Interface，缩写作DPMI）所代，後者在Windows 3.0 开发中诞生<ref name="Duncan_1992_Extended_DOS">{{cite book
|first1=Ray
|last1=Duncan
|first2=Charles
|last2=Petzold
|authorlink2=Charles Petzold
|first3=Andrew
|last3=Schulman
|first4=M. Steven
|last4=Baker
|first5=Ross P.
|last5=Nelson
|first6=Stephen R.
|last6=Davis
|first7=Robert
|last7=Moote
|authorlink7=Robert Moote
|year=1992
|title=Extending DOS: A Programmer's Guide to Protected-Mode DOS
|edition=2nd
|publisher=[[Addison-Wesley|Addison-Wesley]] Publishing Company, Inc.
|isbn=0-201-56798-9
|pages=433–462}}</ref>。它提供了应用接口，以扩展的程序与实模式软件衔接、分配内存、处理中断服务，更让扩展器自己建立了保护模式切换、允许多个保护模式程序的同时共存。

== DOS扩展器举例 ==

* Tenberry 软件公司的{{tsl|en|DOS/4G||DOS/4G、DOS/4GW}}与[[DOS/16M|DOS/16M]]。
* {{tsl|en|Phar Lap (company)|Phar Lap (公司)|Phar Lap}}286|DOS扩展器、386|DOS扩展器。
* Al Williams在《Dr. Dobb's Journal》<ref name=protddj1>{{cite journal |last1=Williams |first1=Al |title=Roll your own DOS extender: Part I |journal=[[Dr._Dobb's_Journal|Dr. Dobb's Journal]] |issn=1044-789X |publisher=[[CMP_Technology|CMP Technology]] |volume=15 |issue=10 |pages=16–18, 20, 24|date=October 1990}}</ref><ref name=protddj2>{{cite journal |last1=Williams |first1=Al |title=Roll Your Own DOS Extender: Part II |journal=[[Dr._Dobb's_Journal|Dr. Dobb's Journal]] |issn=1044-789X |publisher=[[CMP_Technology|CMP Technology]] |volume=15 |issue=11 |pages=74, 76, 80, 81–83, 85, 122–128, 130|date=November 1990}}</ref>内付梓的PROT，是32位DOS扩展器，在另两册书亦有<ref>{{cite book |last=Williams |first=Al |year=1991 |title=DOS 5 A Developer's Guide |publisher=[[MT_Books|MT Books]] |isbn=1-55851-177-6 }}</ref><ref>{{cite book |last=Williams |first=Al |year=1993 |title=DOS 6 A Developer's Guide |url=https://archive.org/details/dos6developersgu0000will |publisher=[[MT_Books|MT Books]] |isbn=1-55851-309-4}}</ref>。该扩展器可在仿真模式运行DOS与调用BIOS的优点，不用真的切换到实模式。
* [[Thomas_Pytel|Thomas Pytel]]、[[Charles_Sheffold|Charles Sheffold]]的{{tsl|en|PMODE|PMODE}}与[http://en.wikipedia.org/wiki/PMODE/W| PMODE/W]{{dead link|date=2017年11月 |bot=InternetArchiveBot |fix-attempted=yes }}後者在Watcom C替代了DOS/4GW，且在[[demoscene|demoscene]]程序员中很流行。
* Ergo（以前是 Eclipse, formerly A. I. Architects）OS/286、OS/386 扩展，与 DPM16、DPM32 服务。
* [[Microsoft_Windows|Microsoft Windows]]在1990年前所有（64位元版本除外）版本的Windows，都{{tsl|en|Virtual DOS machine||包括}}都包括 DPMI服务与 DOS扩展器<ref>{{cite book |last=Williams |first=Al |year=1993 |title=DOS and Windows Protected Mode: Programming with DOS Extenders in C |publisher=[[Addison-Wesley|Addison-Wesley]] |isbn=0-201-63218-7 |page=30}}</ref>。
* [[HX_DOS_Extender|HX DOS Extender]]提供的Win32有限支持。
* DosWin32提供的Win32有限支持。
* Charles W. Sandman的{{tsl|en|CWSDPMI|CWSDPMI}}，是{{tsl|en|DOS Protected Mode Interface|DOS保护模式接口|DPMI}}服务器，使用32位保护模式DOS的[[DJGPP|DJGPP]]程序。
* 旧（pre-v2）版本的GO32使用[[DJGPP|DJGPP]]与[[Free_Pascal|Free Pascal]]。
* Salford 软件的DBOS，是32位保护模式DOS扩展器，主用于其[[FTN77|FTN77]]（Fortran编译器）。
* Narech K模仿{{tsl|en|DOS/4G||DOS/4GW}}的{{tsl|en|DOS/32|DOS/32}}。


== 著名DOS扩展的应用程序 ==
{{unreferenced section|date=March 2011}}

* Adobe Acrobat Reader 1.0（用了早期商务版本 DOS/4GW）
* [[AutoCAD|AutoCAD]] 11（PharLap 386）
* [[Lotus_1-2-3|Lotus 1-2-3]]发行版的第3版（Rational系统DOS/16M）
* [[甲骨文公司|甲骨文公司]]商务版本软件
* [[IBM|IBM]]公司的{{tsl|en|Interleaf|Interleaf}}
* 1980年代的BBS软件包《{{tsl|en|Major BBS|Major BBS}}》，用了{{tsl|en|Phar Lap (company)|Phar Lap (公司)|Phar Lap}}的DOS扩展器。
* [[Quarterdeck_Office_Systems_Quarterdeck|Quarterdeck Office Systems Quarterdeck]]的 [[DESQview|DESQview]]、DESQview/X 多任务软件
* [[Watcom_c|Watcom_c]]在[[C语言|C]]、[[C++|C++]]、[[Fortran|Fortran]]的[[x86|x86]][[编译器|编译器]]
* 1990年代早期中期的无数DOS游戏，多用DOS/4GW，包括:
** [[id_Software|id Software]]的[[毁灭战士|毁灭战士]]及其续集，又如[[雷神之锤_(游戏)|雷神之锤 (游戏)]](用[[DJGPP|DJGPP]]写的)
** [[Looking_Glass_Studios|Looking Glass Studios]]的{{tsl|en|System Shock||网络奇兵}},
** [[Parallax_Software|Parallax Software]]的[[天旋地轉|黑暗侵袭]]
** Crack dot com的[[Abuse_(电子游戏)|Abuse]]
** [[暴雪娱乐|暴雪娱乐]]的[[魔兽争霸:_兽人与人类|魔兽争霸: 兽人与人类]]、[[魔兽争霸II：黑暗之门|魔兽争霸II：黑暗之门]]
** [[3D_Realms|3D Realms]]的[[永远的毁灭公爵|永远的毁灭公爵]]
** [[Midway|Midway]]的[[真人快打系列|真人快打系列]]
** [[西木工作室|西木工作室]]的[[命令与征服|命令与征服]]、[[红色警戒1|红色警戒1]]
** [[DMA_Design|DMA Design]]（现称Rockstar North）的[[侠盗猎车手|侠盗猎车手]]，後期游戏版本移植进了Windows以兼容新型电脑。
** [[NovaLogic|NovaLogic]]的{{tsl|en|Comanche series|科曼奇：全球挑战}}用了特殊的{{tsl|en|Unreal mode|非实模式}}内存管理器，须[[80386|80386]]芯片支持，与其他{{tsl|en|DOS memory management|DOS内存管理|内存管理器}}、{{tsl|en|Virtual DOS machine|虚拟DOS机器}}不兼容，须在[[CONFIG.SYS|CONFIG.SYS]]内配置复杂的{{tsl|en|DOS boot menu|DOS启动菜单}}。後期版本包含了一个DOS扩展器，以解上述难题。
* [[Windows_9x|Windows 9x]]自称为“操作系统”系列，但实为高级的更灵活扩展了MS-DOS代码的Window
** [[Windows_95|Windows 95]]
** [[Windows_98|Windows 98]]/SE
** [[Windows_ME|Windows ME]]

== 参考 ==
{{reflist}}

== 外部链接 ==
* FreeDOS维基上的[https://web.archive.org/web/20090302092520/http://wiki.fdos.org/Main/DOSExtender DOS扩展器]
* [http://www.thefreecountry.com/programming/dosextenders.shtml The Free Country的DOS扩展器列表]

[[Category:DOS内存管理|Category:DOS内存管理]]
[[Category:DOS軟體|Category:DOS軟體]]